
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>For developers &#8212; deeptime 0.2.7+5.gb22c33f0.dirty documentation</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/perfect-scrollbar/css/perfect-scrollbar.css" />
    <link rel="stylesheet" type="text/css" href="_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.css" />
    <link rel="stylesheet" type="text/css" href="_static/katex-math.css" />
    <link rel="stylesheet" type="text/css" href="_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="_static/gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="_static/gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="_static/gallery-rendered-html.css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/perfect-scrollbar/js/perfect-scrollbar.min.js"></script>
    <script src="_static/perfect-scrollbar/js/perfect-scrollbar.min.js"></script>
    <script src="_static/d3.v5.min.js"></script>
    <script src="_static/d3-legend.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.13.11/dist/contrib/auto-render.min.js"></script>
    <script src="_static/katex_autorenderer.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="deeptime.base" href="api/index_base.html" />
    <link rel="prev" title="Asymmetric Quadruple-well" href="datasets/plot_quadruple_well_asymmetric.html" />
<link rel="apple-touch-icon" sizes="180x180" href="_static/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="_static/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="_static/favicon-16x16.png">
<link rel="manifest" href="_static/site.webmanifest">

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="index.html">
    <img class="logo" src="_static/logo/deeptime_romand_white.svg" alt="Logo"/>
    
  </a>
</p>










<!-- h3>Navigation</h3 -->
<p class="caption"><span class="caption-text">Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index_dimreduction.html">Dimension reduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="index_deepdimreduction.html">Deep dim reduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="notebooks/sindy.html">SINDy</a></li>
<li class="toctree-l1"><a class="reference internal" href="index_msm.html">Markov state models</a></li>
<li class="toctree-l1"><a class="reference internal" href="notebooks/hmm.html">Hidden Markov Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="notebooks/clustering.html">Clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="index_examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="datasets/index.html">Datasets</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">For developers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#writing-a-custom-estimator">Writing a custom estimator</a></li>
<li class="toctree-l2"><a class="reference internal" href="#adding-transformer-capabilities">Adding transformer capabilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="#depending-on-pytorch">Depending on PyTorch</a></li>
<li class="toctree-l2"><a class="reference internal" href="#testing-your-code">Testing your code</a></li>
<li class="toctree-l2"><a class="reference internal" href="#documenting-the-code">Documenting the code</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">API docs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api/index_base.html">deeptime.base</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/index_clustering.html">deeptime.clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/index_sindy.html">deeptime.sindy</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/index_covariance.html">deeptime.covariance</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/index_decomposition.html">deeptime.decomposition</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/index_markov.html">deeptime.markov</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/index_markov_hmm.html">deeptime.markov.hmm</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/index_markov_tools.html">deeptime.markov.tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/index_basis.html">deeptime.basis</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/index_kernels.html">deeptime.kernels</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/index_data.html">deeptime.data</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/index_numeric.html">deeptime.numeric</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/index_util.html">deeptime.util</a></li>
</ul>
<p class="caption"><span class="caption-text">Other</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="imprint.html">Imprint</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">Software License</a></li>
</ul>





<!--
<p>
    <iframe src="https://ghbtns.com/github-btn.html?user=deeptime-ml&repo=deeptime&type=star&count=true&size=large&v=2"
            allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>
--><p class="caption">
    <span class="caption-text">Version</span>
</p>
<ul>
    <li class="toctree-l1">
        <a class="reference internal" id="version-latest"
           href="../latest/index.html">Latest release
            (0.2.7)</a>
    </li>
    <li class="toctree-l1">
        <a class="reference internal" id="version-trunk"
           href="../trunk/index.html">Trunk version</a>
    </li>
</ul>
<script>
    if (window.location.href.indexOf("latest") > -1) {
        document.getElementById("version-latest").className = "reference internal current";
        document.getElementById("version-trunk").className = "reference internal";
    } else {
        document.getElementById("version-latest").className = "reference internal";
        document.getElementById("version-trunk").className = "reference internal current";
    }
</script><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="contents.html">Documentation overview</a><ul>
      <li>Previous: <a href="datasets/plot_quadruple_well_asymmetric.html" title="previous chapter">Asymmetric Quadruple-well</a></li>
      <li>Next: <a href="api/index_base.html" title="next chapter">deeptime.base</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" placeholder="Quick search" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script><div class="github-wrapper">
    <a href="https://github.com/deeptime-ml/deeptime"
       style="width: 16rem; height:100%; position:absolute; top:0; left:0;">
        <img class="side-logo logo-github" src="_static/GitHub-Mark-Light-32px.png" alt="gh"/>
        <div style="display: table; height: 100%; overflow: hidden;">
            <div style="display: table-cell; vertical-align: middle;">
                <div>deeptime &#64; GitHub
                </div>
            </div>
        </div>
    </a>
</div>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="for-developers">
<span id="ref-ix-base"></span><h1>For developers<a class="headerlink" href="#for-developers" title="Permalink to this headline">¶</a></h1>
<p>This document is mainly for aspiring contributors to familiarize themselves with the code structure and underlying API.
When it is planned to add a new estimator / model / transformer, the module <a class="reference internal" href="api/index_base.html"><span class="doc">deeptime.base</span></a>
defines the interfaces, which are described in some more detail subsequently.</p>
<div class="section" id="writing-a-custom-estimator">
<h2>Writing a custom estimator<a class="headerlink" href="#writing-a-custom-estimator" title="Permalink to this headline">¶</a></h2>
<p>When writing a custom estimator, first one should decide on what is supposed to be estimated. To this end, a
<a class="reference internal" href="api/generated/deeptime.base.Model.html#deeptime.base.Model" title="deeptime.base.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> can be implemented. For example, implementing a model which can hold mean values:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">deeptime.base</span> <span class="kn">import</span> <span class="n">Model</span>
<span class="k">class</span> <span class="nc">MeanModel</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mean</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mean</span> <span class="o">=</span> <span class="n">mean</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mean</span>
</pre></div>
</div>
<p>is nothing more than a dictionary which inherits from <code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code>.</p>
<p>Subsequently, an Estimator for <code class="code docutils literal notranslate"><span class="pre">MeanModel</span></code> s can be implemented:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">deeptime.base</span> <span class="kn">import</span> <span class="n">Estimator</span>
<span class="k">class</span> <span class="nc">MeanEstimator</span><span class="p">(</span><span class="n">Estimator</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MeanEstimator</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span> <span class="n">axis</span>

    <span class="k">def</span> <span class="nf">fetch_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">MeanModel</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">MeanModel</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span>
</pre></div>
</div>
<p>Some estimators also offer a <code class="code docutils literal notranslate"><span class="pre">partial_fit</span></code>, in which case an existing model is updated.</p>
<p>Now estimator and model can be used:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">100000</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">mean_model</span> <span class="o">=</span> <span class="n">MeanEstimator</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">fetch_model</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">mean_model</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-transformer-capabilities">
<h2>Adding transformer capabilities<a class="headerlink" href="#adding-transformer-capabilities" title="Permalink to this headline">¶</a></h2>
<p>Some models have the capability to transform / project data. For example,
<a class="reference internal" href="api/generated/deeptime.clustering.KMeans.html#deeptime.clustering.KMeans" title="deeptime.clustering.KMeans"><code class="xref py py-class docutils literal notranslate"><span class="pre">k-means</span></code></a> can be used to transform time series to discrete series of
states by assigning each frame to its respective cluster center.</p>
<p>To add this kind of functionality, one can use the <code class="xref py py-class docutils literal notranslate"><span class="pre">Transformer</span></code> interface and implement the abstract
<code class="xref py py-meth docutils literal notranslate"><span class="pre">Transformer.transform()</span></code> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">deeptime.base</span> <span class="kn">import</span> <span class="n">Model</span><span class="p">,</span> <span class="n">Transformer</span>
<span class="k">class</span> <span class="nc">Projector</span><span class="p">(</span><span class="n">Model</span><span class="p">,</span> <span class="n">Transformer</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dim</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span>

    <span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="c1"># projects time series data to &quot;dim&quot;-th dimension</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">]</span>
</pre></div>
</div>
<p>It usually also makes sense to implement the transformer interface for estimators whose models are transformers
by simply calling <code class="code docutils literal notranslate"><span class="pre">self.fetch_model().transform(data)</span></code>, i.e., dispatching the transform call to the current model.</p>
</div>
<div class="section" id="depending-on-pytorch">
<h2>Depending on PyTorch<a class="headerlink" href="#depending-on-pytorch" title="Permalink to this headline">¶</a></h2>
<p>If your code depends on pytorch it is no problem to import it at module level (at the top of your implementation file).
To make it accessible to the parent package via <cite>__init__</cite> however, the import should be wrapped into a call to
<code class="xref py py-func docutils literal notranslate"><span class="pre">module_available</span></code> like so</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ... the init</span>
<span class="kn">from</span> <span class="nn">..util.platform</span> <span class="kn">import</span> <span class="n">module_available</span>
<span class="k">if</span> <span class="n">module_available</span><span class="p">(</span><span class="s2">&quot;torch&quot;</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">.your_module</span> <span class="kn">import</span> <span class="n">MeanEstimator</span><span class="p">,</span> <span class="n">MeanModel</span>
<span class="k">del</span> <span class="n">module_available</span>
</pre></div>
</div>
<p>because there is no hard dependency to PyTorch and functionality should be exposed as available.</p>
</div>
<div class="section" id="testing-your-code">
<h2>Testing your code<a class="headerlink" href="#testing-your-code" title="Permalink to this headline">¶</a></h2>
<p>Tests are designed to be run with <a class="reference external" href="https://docs.pytest.org/en/stable/">py.test</a> which can be obtained via, e.g., pypi
or conda. All tests (except for doctests) are placed inside the toplevel <cite>tests</cite> directory. The tests directory
is organized in the same way as the deeptime package itself. For example, if you developed a new estimator
<code class="code docutils literal notranslate"><span class="pre">MeanEstimator</span></code> in the package <code class="code docutils literal notranslate"><span class="pre">deeptime.some.package</span></code>, then tests should go into
<code class="code docutils literal notranslate"><span class="pre">tests/some/package/test_mean_estimator.py</span></code>.</p>
<p>To execute the tests a call to <code class="code docutils literal notranslate"><span class="pre">pytest</span> <span class="pre">tests/</span></code> suffices. To execute doctests,
<code class="code docutils literal notranslate"><span class="pre">pytest</span> <span class="pre">--doctest-modules</span> <span class="pre">deeptime</span></code> can be called.</p>
</div>
<div class="section" id="documenting-the-code">
<h2>Documenting the code<a class="headerlink" href="#documenting-the-code" title="Permalink to this headline">¶</a></h2>
<p>When documenting your code, <a class="reference external" href="numpydoc.readthedocs.io">numpydoc style</a> should be used. Going back to the example
of the <code class="code docutils literal notranslate"><span class="pre">MeanEstimator</span></code>, this style of documentation would look like the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MeanEstimator</span><span class="p">(</span><span class="n">deeptime</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">Estimator</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot; The mean estimator. It estimates the mean using a complicated algorithm</span>
<span class="sd">    :footcite:`authorofthecomplicatedalgo1988`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    axis : int, optional, default=-1</span>
<span class="sd">        The axis over which to compute the mean. Defaults to -1, which refers to the last axis.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. footbibliography::</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    MeanModel</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">MeanEstimator</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span> <span class="n">axis</span>

    <span class="k">def</span> <span class="nf">fetch_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">MeanModel</span><span class="p">]:</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Fetches the current model. Can be `None` in case :meth:`fit` was not called yet.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        model : MeanModel or None</span>
<span class="sd">            the latest estimated model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model</span>

    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot; Performs the estimation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : ndarray</span>
<span class="sd">            Array over which the mean should be estimated.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self : MeanEstimator</span>
<span class="sd">            Reference to self.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="n">MeanModel</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span>
</pre></div>
</div>
<p>Note the specific style of using citations. For citations there is a package-global BibTeX file under
<code class="code docutils literal notranslate"><span class="pre">docs/source/references.bib</span></code>. These references can then be included into the documentation website
using the citation key as defined in the references file.</p>
<p>The documentation website is hosted via GitHub pages, its sources can be found
<a class="reference external" href="https://github.com/deeptime-ml/deeptime-ml.github.io">here</a>. Please see the
<a class="reference external" href="https://github.com/deeptime-ml/deeptime/tree/main/docs">README</a> on GitHub for instructions on how to build
it.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
<script src="_static/scrollbar.js"></script>

  </body>
</html>